<ng-template #itemListing let-place>
  <div class="card m-4 border-secondary">
    <div class="row g-0">
      <div class="col-lg-8">
        <div class="card-body d-lg-none d-flex justify-content-between">
          <div class="d-flex flex-column align-items-start align-content-start">
            <span class="card-title fs-5 fw-bolder">{{ place.name }}</span>
            <p class="card-text text-body-secondary">&commat;{{ place.address?.suburb }}</p>
          </div>
          <div class="service-container col-6 d-flex flex-column align-self-center">
            <div class="card-text text-body-secondary d-flex justify-content-end">
              <span class="fs-6">Avg Ambience:</span>
              <span class="mx-2 fw-bolder">{{ place.ambience | number: '1.1-1' }}</span>
            </div>
            <div class="card-text text-body-secondary d-flex justify-content-end">
              <span class="fs-6">Avg Service:</span>
              <span class="mx-2 fw-bolder">{{ place.service | number: '1.1-1' }}</span>
            </div>
          </div>
        </div>

        <!--        new -->
        @if (place.items?.[0]?.reviews?.length) {
          <ngb-carousel
            [showNavigationArrows]="config.carousel.showNavigationArrows"
            [showNavigationIndicators]="config.carousel.showNavigationIndicators"
            [pauseOnHover]="config.carousel.pauseOnHover"
            [pauseOnFocus]="config.carousel.pauseOnFocus"
            [interval]="+config.carousel.interval"
            (mouseenter)="canPause($event, true)"
            (mouseleave)="canPause($event, false)"
            (slide)="changeCarouselSlide($event)"
            #reviewImgCarousel>
            @for (review of place.items?.[0]?.reviews; track review; ) {
              @if(review?.medias?.length){
                @for (media of review.medias; track media; ) {
                  <ng-template ngbSlide>
                    <div class="picsum-img-wrapper d-flex justify-content-center align-content-center">
                      @if (media.key) {
                        <img
                          [src]="config.bucketAccessEndpoint+'/'+media.key"
                          alt="loading picture of the dish"
                          class="card-img-top place-list-img w-100 img-fluid rounded-0" />
                      } @else {
                        <span class="text-secondary-emphasis ">
                            <svg xmlns="http://www.w3.org/2000/svg" height="11rem" viewBox="0 -960 960 960"
                                 width="15rem"
                                 fill="#999999"><path
                              d="M180-120q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h600q24 0 42 18t18 42v600q0 24-18 42t-42 18H180Zm0-60h600v-600H180v600Zm56-97h489L578-473 446-302l-93-127-117 152Zm-56 97v-600 600Z" /></svg>
                          </span>
                      }
                    </div>
                  </ng-template>
                }
              } @else {
                <span class="text-secondary-emphasis ">
                            <svg xmlns="http://www.w3.org/2000/svg" height="11rem" viewBox="0 -960 960 960"
                                 width="15rem"
                                 fill="#999999"><path
                              d="M180-120q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h600q24 0 42 18t18 42v600q0 24-18 42t-42 18H180Zm0-60h600v-600H180v600Zm56-97h489L578-473 446-302l-93-127-117 152Zm-56 97v-600 600Z" /></svg>
                          </span>
              }

            }
          </ngb-carousel>

        } @else if (place.items?.[0].media?.key) {
          <div class="picsum-img-wrapper">
            <img
              [src]="config.bucketAccessEndpoint+'/'+place.items[0].media.key"
              alt="loading picture of the dish"
              class="card-img-top place-list-img w-100 img-fluid rounded-0" />
          </div>
        } @else {
          <div class="picsum-img-wrapper">
              <span class="text-secondary-emphasis ">
                            <svg xmlns="http://www.w3.org/2000/svg" height="11rem" viewBox="0 -960 960 960"
                                 width="15rem"
                                 fill="#999999"><path
                              d="M180-120q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h600q24 0 42 18t18 42v600q0 24-18 42t-42 18H180Zm0-60h600v-600H180v600Zm56-97h489L578-473 446-302l-93-127-117 152Zm-56 97v-600 600Z" /></svg>
                          </span>

          </div>
        }
      </div>

      <div class="col-lg-4 card-body d-flex flex-column justify-content-center">
        <div class="card-body d-none d-lg-flex flex-column align-items-center align-content-center p-0">
          <h5 class="card-title h4">{{ place.name }}</h5>
          <p class="card-text text-body-secondary">&commat;{{ place.address?.suburb }}</p>
        </div>
        <div class="service-container col-6 d-none d-lg-flex flex-column align-self-center">
          <div class="card-text text-body-secondary d-flex justify-content-between">
            <span class="fs-6">Ambience:</span> <span class="fs-6">{{ place.ambience | number: '1.1-1' }}</span>
          </div>
          <div class="card-text text-body-secondary d-flex justify-content-between">
            <span class="fs-6">Service:</span> <span class="fs-6">{{ place.service | number: '1.1-1' }}</span>
          </div>
        </div>

        <!--        View all for mobile container-->
        <div class="card-body view-photos-container d-block d-lg-none pt-0 fs-5">
          <a href="#" class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">{{
              config.allReviewPhotosLabel
            }}</a>
        </div>
        <div class="card-body taste-container">
          <span class="d-flex flex-row card-text text-body-secondary">Taste</span>
          <div class="d-flex flex-row align-items-center justify-content-between progress-container">
            <div
              class="progress rounded-0 w-100 h-100 me-1"
              role="progressbar"
              [attr.aria-label]="'Taste is rated at ' + (place.items?.[0]?.taste | number: '1.1')"
              aria-valuemin="0"
              aria-valuemax="100">
              <div class="progress-bar" [style]="'width: ' + place.items?.[0]?.taste * 20 + '%'"></div>
            </div>
            <span class="ms-1 card-text text-body-secondary text-dark fw-bolder">{{
                place.items?.[0]?.taste | number: '1.1-1'
              }}</span>
          </div>
        </div>

        <div class="card-body presentation-container">
          <span class="d-flex flex-row card-text text-body-secondary">Presentation</span>
          <div class="d-flex flex-row align-items-center justify-content-between progress-container">
            <div
              class="progress rounded-0 w-100 h-100 me-1"
              role="progressbar"
              [attr.aria-label]="'Presentation is rated at ' + (place.items?.[0]?.presentation | number: '1.1')"
              aria-valuemin="0"
              aria-valuemax="100">
              <div class="progress-bar" [style]="'width: ' + place.items?.[0]?.presentation * 20 + '%'"></div>
            </div>
            <span class="ms-1 card-text text-body-secondary text-dark fw-bolder">{{
                place.items?.[0]?.presentation | number: '1.1-1'
              }}</span>
          </div>
        </div>
        <!--        dont display this in mobile view-->
        <div class="card-body view-photos-container d-none d-lg-block">
          <a href="#" class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">{{
              config.allReviewPhotosLabel
            }}</a>
        </div>
      </div>
    </div>
    <div class="row g-0">
      <hr class="dropdown-divider bg-secondary-subtle" />
      <div class="col">
        <div class="card-body text-truncate-container">
          <ngb-carousel
            [showNavigationArrows]="false"
            [showNavigationIndicators]="false"
            [pauseOnHover]="config.carousel.pauseOnHover"
            [pauseOnFocus]="config.carousel.pauseOnFocus"
            [interval]="+config.carousel.interval"
            (mouseenter)="canPause($event, true)"
            (mouseleave)="canPause($event, false)"
            #reviewTextCarousel>
            <ng-container *ngFor="let review of place.items?.[0]?.reviews">
              <ng-container *ngFor="let _ of review?.medias; let firstMedia = first">
                <ng-template ngbSlide>
                  <div class="picsum-img-wrapper">
                    <p class="card-text carousel-text text-truncate-3">{{ review?.description }}</p>
                  </div>
                </ng-template>
              </ng-container>
            </ng-container>
          </ngb-carousel>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-container *ngIf="place">
  <ng-container *ngTemplateOutlet="itemListing; context: { $implicit: place }"></ng-container>
</ng-container>
